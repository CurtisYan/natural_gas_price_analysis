# 天然气存储合约定价模型说明文档

## 概述
本定价模型用于评估天然气存储合约的价值，综合考虑了注入成本、提取收入和存储成本等所有相关现金流。模型采用蒙特卡洛模拟方法，并使用GARCH(1,1)模型进行价格预测。

## 核心功能

### 1. 价格模拟函数
- **函数名**: `simulate_future_prices()`
- **方法**: GARCH(1,1)模型估计波动率
- **输出**: 多条价格路径用于蒙特卡洛模拟
- **基础**: 历史价格数据分析

### 2. 合约定价函数
- **函数名**: `value_gas_storage_contract()`
- **考虑的现金流**：
  - 注入时的购买成本
  - 提取时的销售收入
  - 每日存储成本
  - 最大存储容量约束
  - 注入/提取速率限制

### 3. 关键约束条件
- 最大存储容量检查
- 注入/提取速率验证
- 存储时长计算
- 现金流时间优化

## 输入参数

| 参数 | 说明 | 类型 |
|------|------|------|
| `injection_dates` | 注入日期列表 | List[datetime] |
| `withdrawal_dates` | 提取日期列表 | List[datetime] |
| `injection_prices` | 注入时的价格（固定或模拟） | Array |
| `withdrawal_prices` | 提取时的价格（固定或模拟） | Array |
| `injection_rate` | 每日注入速率 | Float |
| `withdrawal_rate` | 每日提取速率 | Float |
| `max_storage` | 最大存储容量 | Float |
| `storage_cost_per_day` | 每单位每日存储成本 | Float |
| `gas_amounts` | 每次操作的天然气数量 | List[Float] |

## 输出结果
- **主要输出**: 合约总价值（所有现金流的净现值）
- **次要输出**: 约束违反时的验证信息

## 应用场景

### 1. 季节性套利
- 夏季低价买入
- 冬季高价卖出
- 优化存储时长

### 2. 多次操作
- 复杂的注入/提取计划
- 投资组合优化
- 风险管理

### 3. 快速周转
- 短期价差交易
- 最小化存储成本
- 最大化周转率

## 模型优势
- **灵活性**: 可处理任意数量的操作
- **真实性**: 包含物理约束条件
- **全面性**: 考虑所有相关成本
- **不确定性**: 具备价格模拟能力

## 使用示例
```python
# 简单的季节性策略
contract_value = value_gas_storage_contract(
    injection_dates=[datetime(2024, 6, 1)],
    withdrawal_dates=[datetime(2024, 12, 1)],
    injection_prices=np.array([10.5]),
    withdrawal_prices=np.array([12.8]),
    injection_rate=1000,
    withdrawal_rate=1500,
    max_storage=100000,
    storage_cost_per_day=0.01,
    gas_amounts=[50000]
)
```

## 技术实现要点

### 1. 价格模拟
- 使用历史数据计算收益率
- GARCH模型估计条件波动率
- 生成未来价格路径

### 2. 约束验证
- 检查存储容量限制
- 验证操作时间合理性
- 确保现金流计算准确

### 3. 价值计算
- 计算所有现金流
- 考虑时间价值（当前版本假设利率为零）
- 返回净现值

## 模型局限性
- 假设无运输延迟
- 利率设为零（可扩展）
- 不考虑市场假期
- 价格模拟基于历史数据

## 未来改进方向
1. 加入利率期限结构
2. 考虑运输成本和延迟
3. 添加更复杂的价格模型
4. 优化算法提高计算效率
5. 加入实时市场数据接口

## 联系信息
如有问题或改进建议，请联系开发团队。

## 版本信息
- 版本：1.0
- 最后更新：2024年
